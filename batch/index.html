<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>AIãƒ¡ãƒ¼ãƒ«æƒ…å ±ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <style>
    :root {
      --primary-bg: #f8f9fa;
      --secondary-bg: #ffffff;
      --border-color: #dee2e6;
      --header-bg: #343a40;
      --header-text: #ffffff;
      --table-header-bg: #e9ecef;
      --accent-color: #007bff;
      --text-color: #212529;
      --link-color: #0056b3;
      --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    body {
      font-family: var(--font-family);
      background-color: var(--primary-bg);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
    }
    .container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    .left-pane {
      width: 100%;
      min-width: 500px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border-color);
      transition: width 0.3s ease-in-out;
      box-sizing: border-box;
    }
    .left-pane.shrunk {
      width: 60%;
    }
    .right-pane {
      width: 0;
      padding: 0;
      background-color: var(--secondary-bg);
      position: relative;
      display: flex;
      flex-direction: column;
      transition: width 0.3s ease-in-out, padding 0.3s ease-in-out;
      overflow: hidden;
      box-sizing: border-box;
    }
    .right-pane:not(.hidden) {
      width: 40%;
      padding: 15px;
    }
    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      flex-shrink: 0;
    }
    .preview-header-left {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    #open-gmail-btn {
        background-color: #c82333;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
    }
    .preview-info {
      padding: 10px;
      background-color: #f1f3f5;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      margin-bottom: 10px;
      font-size: 0.9em;
      line-height: 1.6;
      flex-shrink: 0;
    }
    #preview-subject:hover {
      text-decoration: underline;
      background-color: #e9ecef;
    }

    .preview-info strong {
      margin-right: 5px;
    }
    .preview-info span {
      margin-right: 15px;
    }
    #mail-preview {
      width: 100%;
      height: 100%;
      border: 1px solid var(--border-color);
      flex-grow: 1;
    }
    .close-btn {
      font-size: 24px;
      cursor: pointer;
      font-weight: bold;
      border: none;
      background: none;
      padding: 0 10px;
    }
    .search-area, .matching-area, .import-area {
      background-color: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }
     .results-area {
      background-color: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      flex: 1;
      overflow: auto;
    }
    .search-area h2, .results-area h2, .matching-area h2, .import-area h2 {
      margin-top: 0;
      font-size: 1.2em;
    }
    .form-group {
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px 10px;
      align-items: center;
    }
    .form-group label {
      font-weight: bold;
      margin-right: 5px;
    }
    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      box-sizing: border-box;
    }
    
    .skill-category {
      border: 1px solid var(--border-color);
      border-radius: 4px;
      flex: 1 1 45%;
    }
    .skill-category summary {
      font-weight: bold;
      padding: 8px;
      cursor: pointer;
      background-color: #f8f9fa;
    }
    .skill-tags-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      padding: 10px;
    }
    .skill-tag-item label {
      cursor: pointer;
    }
    
    .data-table {
      min-width: 1800px;
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    .data-table th, .data-table td {
      border: 1px solid var(--border-color);
      padding: 8px;
      text-align: left;
      font-size: 0.9em;
      vertical-align: top;
      word-wrap: break-word;
    }
    .data-table th {
      background-color: var(--table-header-bg);
      color: var(--text-color);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .data-table a {
      color: var(--link-color);
      text-decoration: underline;
      cursor: pointer;
    }
    .data-table tbody tr {
        cursor: pointer;
    }
    .data-table tbody tr:hover {
        background-color: #f0f0f0;
    }

    /* â˜…â˜…â˜… ä¿®æ­£: ãƒ†ãƒ¼ãƒ–ãƒ«åˆ—ã®å¹… â˜…â˜…â˜… */
    .col-id { width: 3em; }
    .col-received-date { width: 5em; white-space: pre-line; }
    .col-company { width: 8em; }
    .col-name { width: 4em; }
    .col-project-name { width: 8em; }
    .col-gender { width: 4em; }
    .col-age { width: 4em; }
    .col-price { width: 4em; }
    .col-station, .col-location { width: 8em; }
    .col-affiliation { width: 6em; }
    .col-skill-tags { width: 10em; }
    .col-period { width: 6em; }
    .col-nationality { width: 5em; }
    .col-desired-position, .col-required-position { width: 10em; }
    .col-skill-summary, .col-wish-summary, .col-other-summary, .col-skill-req-summary {
        width: 15em;
    }

    .id-link { cursor: pointer; color: var(--accent-color); font-weight: bold; }
    .hidden { display: none; }
    #loader {
      text-align: center;
      padding: 20px;
      font-weight: bold;
    }
    #motivational-quote {
        margin-top: 15px;
        font-style: italic;
        color: #343a40;
        font-size: 1.3em;
    }
    .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 15px;
        background-color: var(--header-bg);
        color: var(--header-text);
        flex-shrink: 0;
    }
    .header-bar-left {
        display: flex;
        align-items: center;
        gap: 20px;
    }
    .header-bar h1 {
        margin: 0;
        font-size: 1.5em;
    }
    .header-buttons button {
        margin-left: 10px;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        color: white;
    }
    #refresh-cache-btn {
        background-color: #28a745;
    }
    #delete-data-btn {
        background-color: #dc3545;
    }
    
    #matching-text { width: 100%; height: 100px; }
    #matching-results ul { list-style-type: none; padding-left: 0; }
    #matching-results li { background-color: #e9ecef; padding: 10px; margin-bottom: 5px; border-radius: 4px; }
    #matching-results li strong { color: var(--accent-color); }
    #matching-results li:hover { background-color: #dcdcdc; cursor: pointer; }
    
    .header-tab-nav {
        display: flex;
        height: 100%;
    }
    .header-tab-link {
        background-color: transparent;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 20px;
        transition: background-color 0.3s;
        font-size: 1em;
        color: var(--header-text);
        border-bottom: 3px solid transparent;
    }
    .header-tab-link:hover {
        background-color: rgba(255,255,255,0.1);
    }
    .header-tab-link.active {
        background-color: rgba(255,255,255,0.2);
        border-bottom: 3px solid var(--accent-color);
    }

    .tab-content {
        display: none;
        flex-direction: column;
        flex: 1;
        overflow: auto;
    }
    
    .matching-buttons button, #import-btn {
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        color: white;
        border: none;
    }
    #matching-btn { background-color: var(--accent-color); }
    #cancel-matching-btn { background-color: #6c757d; }
    #import-btn { background-color: #28a745; }

    .filter-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    #reset-search-btn {
        padding: 6px 12px;
        font-size: 0.9em;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    #reset-search-btn:hover {
        background-color: #5a6268;
    }
    
    #import-urls {
      width: 100%;
      height: 120px;
      font-family: monospace;
    }
    #import-results {
      margin-top: 15px;
      padding: 10px;
      background-color: #e9ecef;
      border-radius: 4px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    #skill-tags-toggle {
        cursor: pointer;
        user-select: none;
        display: flex;
        align-items: center;
        gap: 8px;
        width: 100%;
        padding: 5px 0;
    }
    #skill-tags-container {
        overflow: hidden;
        transition: max-height 0.4s ease-in-out, margin-top 0.4s ease-in-out;
        max-height: 1500px;
        margin-top: 10px;
        width: 100%;
    }
    #skill-tags-container.collapsed {
        max-height: 0;
        margin-top: 0;
    }
    
    .filter-top-row {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 10px;
    }
    .filter-col-left {
      flex: 2;
      min-width: 250px;
    }
    .filter-col-right {
      flex: 3;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px 20px;
    }
    .filter-group-inline .form-group {
      margin-bottom: 0;
    }
    input.small-input {
      width: 60px;
    }

  </style>
</head>
<body>

  <div class="header-bar">
    <div class="header-bar-left">
        <h1>AIãƒ¡ãƒ¼ãƒ«æƒ…å ±ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        <div class="header-tab-nav">
          <button id="defaultOpen" class="header-tab-link active" onclick="openTab(event, 'search-tab')">æ¤œç´¢</button>
          <button class="header-tab-link" onclick="openTab(event, 'matching-tab')">AIãƒãƒƒãƒãƒ³ã‚°</button>
          <button class="header-tab-link" onclick="openTab(event, 'import-tab')">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
          <button class="header-tab-link" onclick="openTab(event, 'url-search-tab')">URLæ¨ªæ–­æ¤œç´¢</button>
        </div>
    </div>
    <div class="header-buttons">
      <button id="refresh-cache-btn">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°</button>
      <button id="delete-data-btn">å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button>
    </div>
  </div>

  <div class="container">
    <div class="left-pane" id="left-pane">

      <div id="search-tab" class="tab-content">
        <div class="search-area">
          <div class="filter-header">
            <h2>æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h2>
            <button type="button" id="reset-search-btn">æ¤œç´¢æ¡ä»¶ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <form id="search-form">
            <div class="form-group">
              <label>DBé¸æŠ:</label>
              <input type="radio" id="db_jinzai" name="db_type" value="jinzai" checked>
              <label for="db_jinzai">äººæDB</label>
              <input type="radio" id="db_anken" name="db_type" value="anken">
              <label for="db_anken">æ¡ˆä»¶DB</label>
            </div>
            <div id="jinzai-filters">
                <div class="form-group">
                    <input type="text" id="free_word" placeholder="ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ (å…¨ä½“)" style="width: 100%;">
                </div>
                <div class="form-group">
                    <label for="age_min">å¹´é½¢:</label>
                    <input type="number" id="age_min" placeholder="ä¸‹é™"> ~ <input type="number" id="age_max" placeholder="ä¸Šé™">
                    <label for="price_min_jinzai">å˜ä¾¡(ä¸‡):</label>
                    <input type="number" id="price_min_jinzai" placeholder="ä¸‹é™"> ~ <input type="number" id="price_max_jinzai" placeholder="ä¸Šé™">
                    <label for="work_style_jinzai">å‡ºç¤¾å¯å¦:</label>
                    <select id="work_style_jinzai">
                    <option value="">ã™ã¹ã¦</option>
                    <option value="å‡ºç¤¾">å‡ºç¤¾</option>
                    <option value="ãƒªãƒ¢ãƒ¼ãƒˆ">ãƒªãƒ¢ãƒ¼ãƒˆ</option>
                    <option value="ä½µç”¨">ä½µç”¨</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ‰€å±ç¨®åˆ¥:</label>
                    <input type="radio" id="affiliation_all" name="affiliation_type" value="all" checked>
                    <label for="affiliation_all">ã™ã¹ã¦</label>
                    <input type="radio" id="affiliation_employee" name="affiliation_type" value="employee">
                    <label for="affiliation_employee">ç¤¾å“¡</label>
                    <input type="radio" id="affiliation_other" name="affiliation_type" value="other">
                    <label for="affiliation_other">ãã®ä»–</label>

                    <label style="margin-left: 20px;">å›½ç±:</label>
                    <input type="radio" id="nationality_all" name="nationality_type" value="all" checked>
                    <label for="nationality_all">ã™ã¹ã¦</label>
                    <input type="radio" id="nationality_jp" name="nationality_type" value="æ—¥æœ¬ç±">
                    <label for="nationality_jp">æ—¥æœ¬ç±</label>
                    <input type="radio" id="nationality_foreign" name="nationality_type" value="å¤–å›½ç±">
                    <label for="nationality_foreign">å¤–å›½ç±</label>
                </div>
            </div>
            <div id="anken-filters" class="hidden">
                <div class="form-group">
                    <input type="text" id="free_word_anken" placeholder="ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ (å…¨ä½“)" style="width: 100%;">
                </div>
                <div class="form-group">
                    <label for="price_min_anken">å˜ä¾¡(ä¸‡):</label>
                    <input type="number" id="price_min_anken" placeholder="ä¸‹é™"> ~ <input type="number" id="price_max_anken" placeholder="ä¸Šé™">
                    <label for="work_style_anken">å‡ºç¤¾å¯å¦:</label>
                    <select id="work_style_anken">
                    <option value="">ã™ã¹ã¦</option>
                    <option value="å‡ºç¤¾">å‡ºç¤¾</option>
                    <option value="ãƒªãƒ¢ãƒ¼ãƒˆ">ãƒªãƒ¢ãƒ¼ãƒˆ</option>
                    <option value="ä½µç”¨">ä½µç”¨</option>
                    </select>
                </div>
            </div>
            <div class="form-group" style="flex-direction: column; align-items: flex-start; margin-bottom: 0;">
              <label id="skill-tags-toggle">
                ã‚¹ã‚­ãƒ«ã‚¿ã‚° (ANDæ¤œç´¢) <span id="skill-tags-toggle-icon">â–¶</span>
              </label>
              <div id="skill-tags-container" class="collapsed"></div>
            </div>
          </form>
        </div>
        <div class="results-area">
          <div class="results-header">
            <h2>æ¤œç´¢çµæœ <span id="results-count"></span></h2>
            <div id="pagination-controls"></div>
          </div>
          <div id="loader" class="hidden">
            æ¤œç´¢ä¸­...
            <p id="motivational-quote"></p>
          </div>
          <div id="results-table-container"></div>
        </div>
      </div>

      <div id="matching-tab" class="tab-content">
        <div class="matching-area">
          <h2>AIãƒãƒƒãƒãƒ³ã‚°æ©Ÿèƒ½</h2>
          <div class="form-group">
            <label>ãƒãƒƒãƒãƒ³ã‚°å…ƒ:</label>
            <input type="radio" id="match_type_jinzai" name="match_type" value="jinzai" checked>
            <label for="match_type_jinzai">äººææƒ…å ±ã‹ã‚‰æ¡ˆä»¶ã‚’æ¢ã™</label>
            <input type="radio" id="match_type_anken" name="match_type" value="anken">
            <label for="match_type_anken">æ¡ˆä»¶æƒ…å ±ã‹ã‚‰äººæã‚’æ¢ã™</label>
          </div>
          <div class="form-group">
            <label for="matching-id" id="matching-id-label">IDã§äººæã‚’æŒ‡å®š:</label>
            <input type="text" id="matching-id" placeholder="äººæDBã®IDã‚’å…¥åŠ›">
            <span style="margin: 0 10px;">ã¾ãŸã¯</span>
          </div>
          <div class="form-group">
            <textarea id="matching-text" placeholder="ã“ã“ã«äººææƒ…å ±ã¾ãŸã¯æ¡ˆä»¶æƒ…å ±ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘"></textarea>
          </div>
          <div class="form-group">
             <label for="max-matching-results">æœ€å¤§å–å¾—ä»¶æ•°:</label>
             <input type="number" id="max-matching-results" value="20" min="1" max="50" style="width: 60px;">
             <label for="matching-prompt" style="margin-left: 20px;">è¿½åŠ æ¡ä»¶:</label>
             <input type="text" id="matching-prompt" placeholder="" style="flex-grow: 1;">
          </div>
          <div class="matching-buttons">
            <button id="matching-btn">ãƒãƒƒãƒãƒ³ã‚°é–‹å§‹</button>
            <button id="cancel-matching-btn" class="hidden">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          </div>
          <div id="matching-results"></div>
        </div>
      </div>
      
      <div id="import-tab" class="tab-content" style="display: block; flex: 1;">
        <div class="import-area">
          <h2>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h2>
          <p>Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’æ”¹è¡Œã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
          AIãŒã‚·ãƒ¼ãƒˆã®å†…å®¹ï¼ˆäººæ or æ¡ˆä»¶ï¼‰ã‚’è‡ªå‹•ã§åˆ¤æ–­ã—ã€é©åˆ‡ãªDBã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚<br>
          <strong>æ³¨æ„:</strong> å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã€å¯¾è±¡ã‚·ãƒ¼ãƒˆã®ã€Œé–²è¦§è€…ã€ä»¥ä¸Šã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
          <div class="form-group">
            <label for="import-urls">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL:</label>
            <textarea id="import-urls" placeholder="https://docs.google.com/spreadsheets/d/xxxxxxxxxx/edit&#10;https://docs.google.com/spreadsheets/d/yyyyyyyyyy/edit"></textarea>
          </div>
          <button id="import-btn">ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ</button>
          <div id="import-loader" class="hidden" style="margin-top: 15px;">
             ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‡¦ç†ã‚’å®Ÿè¡Œä¸­... AIã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã®ãŸã‚ã€æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
          </div>
          <div id="import-results"></div>
        </div>
      </div>

      <div id="url-search-tab" class="tab-content">
        <div class="import-area">
          <h2>URLæ¨ªæ–­æ¤œç´¢</h2>
          <p>Googleãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€ã¾ãŸã¯å…¬é–‹Webãƒšãƒ¼ã‚¸ã®URLã‚’æ”¹è¡Œã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã€<br>
          æŒ‡å®šã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæœ¬æ–‡ã«å«ã¾ã‚Œã‚‹URLã‚’æ¤œç´¢ã—ã¾ã™ã€‚</p>
          <div class="form-group">
            <label for="search-urls">æ¤œç´¢å¯¾è±¡URL:</label>
            <textarea id="search-urls" placeholder="https://docs.google.com/document/d/xxxxxxxxxx/edit&#10;https://example.com/page.html" style="height: 150px; width: 100%;"></textarea>
          </div>
          <div class="form-group">
            <label for="search-keyword">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</label>
            <input type="text" id="search-keyword" placeholder="æ¤œç´¢ã—ãŸã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" style="width: 300px;">
          </div>
          <button id="url-search-btn" class="matching-buttons" style="background-color: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">æ¤œç´¢å®Ÿè¡Œ</button>
          <div id="url-search-loader" class="hidden" style="margin-top: 15px;">
             æ¤œç´¢ä¸­...
          </div>
          <div id="url-search-results" style="margin-top: 15px;"></div>
        </div>
      </div>


    </div>
    <div class="right-pane hidden" id="preview-pane">
        <div class="preview-header">
            <div class="preview-header-left">
                <h3>ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                <button id="open-gmail-btn" class="hidden">Gmailã§é–‹ã</button>
            </div>
            <button class="close-btn" id="close-preview-btn">Ã—</button>
        </div>
        <div id="preview-info" class="preview-info"></div>
        <iframe id="mail-preview"></iframe>
    </div>
  </div>

<script>
  // ===============================================================
  // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ãƒ»å®šæ•°
  // ===============================================================
  const SKILL_CATEGORIES = {
    "ğŸ§‘â€ğŸ’» ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª": ["ABAP", "ActionScript", "Apex", "Bash", "C", "C#", "C++", "C Shell", "COBOL", "CSS", "Dart", "Go (Golang)", "HTML", "Java", "JavaScript", "Kotlin", "Lua", "MATLAB", "Objective-C", "Pascal", "Perl", "PHP", "Pro*C", "Python", "R", "Ruby", "Rust", "Sass", "Scala", "Shell", "Shell Script", "SQL", "Swift", "TypeScript", "VBA", "VBScript", "Visual Basic", "XML", "YAML"],
    "ğŸ—ï¸ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯": [".NET", "Angular", "ASP.NET", "Backbone.js", "Blazor", "Bootstrap", "CakePHP", "Cocos2d-x", "CodeIgniter", "Django", "Electron", "Entity Framework", "Express.js", "FastAPI", "Flask", "Flutter", "FuelPHP", "Gin", "Hibernate", "jQuery", "Laravel", "MyBatis", "NestJS", "Next.js", "Node.js", "Nuxt.js", "Play Framework", "React", "React Native", "Ruby on Rails", "Spring", "Spring Boot", "Struts", "SwiftUI", "Symfony", "Tailwind CSS", "TERASOLUNA", "Thymeleaf", "Unreal Engine", "Unity", "Vue.js", "Vuetify", "WPF", "Yii", "Zend Framework"],
    "ğŸ“¦ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è£½å“": ["BizRobo!", "Blue Prism", "Business Objects", "Dr.Sum", "Drupal", "Dynamics 365", "EC-CUBE", "HULFT", "Intra-mart", "Marketing Cloud", "Marketo", "Movable Type", "Oracle EBS", "Pardot", "S/4HANA", "Salesforce", "SAP", "ServiceNow", "Shopify", "Systemwalker", "UiPath", "WinActor", "WordPress"],
    "ğŸ› ï¸ ãƒ„ãƒ¼ãƒ«": ["Active Directory", "Anaconda", "Android Studio", "Ansible", "Apache", "Atom", "AutoCAD", "ChatGPT", "Confluence", "DataDog", "DataSpider", "Databricks", "DB2", "dbt", "DBeaver", "Docker", "Eclipse", "Elasticsearch", "F5", "FortiGate", "GAS (Google Apps Script)", "Git", "GitHub", "GitLab", "Gradle", "GraphQL", "IIS", "Informatica", "IntelliJ", "JBoss", "Jenkins", "Jira", "JMeter", "Jupyter", "Keras", "Kibana", "Kubernetes", "LoadBalancer", "MariaDB", "Maven", "Metabase", "MongoDB", "MySQL", "Nagios", "NetBeans", "New Relic", "Nginx", "NumPy", "OpenAPI", "Oracle Database", "Palo Alto", "Pandas", "phpMyAdmin", "Podman", "PostgreSQL", "Postman", "PowerShell", "PuTTY", "PyTorch", "Qt", "Redash", "Redis", "Scikit-learn", "Selenium", "Snowflake", "Splunk", "SQL Server", "SQL Server Management Studio (SSMS)", "SQLite", "Subversion (SVN)", "Swagger", "TensorFlow", "Tera Term", "Terraform", "Tivoli", "Tomcat", "Visual Studio", "Visual Studio Code (VSCode)", "WebLogic", "WebSphere", "WinSCP", "Wireshark", "Zabbix"],
    "â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ": ["AlibabaCloud", "AWS (Amazon Web Services)", "Azure", "BigQuery", "CosmosDB", "Firebase", "Firestore", "GCP (Google Cloud Platform)", "Heroku", "OCI (Oracle Cloud Infrastructure)", "Vercel"]
  };
  const JINZAI_HEADERS = ["ID", "å—ä¿¡æ—¥æ™‚", "ç¤¾å", "æ°å", "æ€§åˆ¥", "å›½ç±", "å¹´é½¢", "å˜ä¾¡", "æœ€å¯„é§…", "æ‰€å±", "ã‚¹ã‚­ãƒ«ã‚¿ã‚°", "ã‚¹ã‚­ãƒ«ã‚µãƒãƒªãƒ¼", "å¸Œæœ›ã‚µãƒãƒªãƒ¼", "å¸Œæœ›ãƒã‚¸ã‚·ãƒ§ãƒ³", "ãã®ä»–ã‚µãƒãƒªãƒ¼"];
  const ANKEN_HEADERS = ["ID", "å—ä¿¡æ—¥æ™‚", "ç¤¾å", "æ¡ˆä»¶å", "å ´æ‰€", "ã‚¹ã‚­ãƒ«ã‚¿ã‚°", "ã‚¹ã‚­ãƒ«è¦ä»¶ã‚µãƒãƒªãƒ¼", "æ±‚ã‚ã‚‹ãƒã‚¸ã‚·ãƒ§ãƒ³", "å˜ä¾¡", "æœŸé–“", "ãã®ä»–ã‚µãƒãƒªãƒ¼"];
  let isMatchingCancelled = false;
  let currentPage = 1;
  const ITEMS_PER_PAGE = 50;
  let searchRetryCount = 0;
  
  const SALES_QUOTES = [
    "ç¾çŠ¶ç¶­æŒã§ã¯å¾Œé€€ã™ã‚‹ã°ã‹ã‚Šã§ã‚ã‚‹ã€‚", "æˆåŠŸã¨ã¯99ï¼…ã®å¤±æ•—ã§ã‚ã‚‹ã€‚", "å¤±æ•—ï¼Ÿã“ã‚Œã¯ã†ã¾ãã„ã‹ãªã„ã¨ã„ã†ã“ã¨ã‚’ç¢ºèªã—ãŸæˆåŠŸã ã‚ˆã€‚", "è¡Œå‹•ã ã‘ãŒã€å¾Œæ‚”ã‚’ç”Ÿã¾ãªã„å”¯ä¸€ã®é¸æŠè‚¢ã ã€‚",
    "å¤§ããªã“ã¨ã‚’æˆã—é‚ã’ã‚‹ãŸã‚ã®å”¯ä¸€ã®æ–¹æ³•ã¯ã€è‡ªåˆ†ã®ä»•äº‹ã‚’æ„›ã™ã‚‹ã“ã¨ã ã€‚", "å›°é›£ã®ä¸­ã«ã€æ©Ÿä¼šãŒã‚ã‚‹ã€‚", "åƒé‡Œã®é“ã‚‚ä¸€æ­©ã‹ã‚‰ã€‚", "è€ƒãˆã‚’è¡Œå‹•ã«ç§»ã•ãªã„é™ã‚Šã€ãã‚Œã¯ä¾¡å€¤ã®ãªã„ã‚‚ã®ã ã€‚",
    "æœ€ã‚‚å¤§ããªãƒªã‚¹ã‚¯ã¯ã€ãƒªã‚¹ã‚¯ã‚’å–ã‚‰ãªã„ã“ã¨ã ã€‚", "æœªæ¥ã‚’äºˆæ¸¬ã™ã‚‹æœ€å–„ã®æ–¹æ³•ã¯ã€ãã‚Œã‚’ç™ºæ˜ã™ã‚‹ã“ã¨ã ã€‚", "å‡¡äº‹å¾¹åº•ã€‚å½“ãŸã‚Šå‰ã®ã“ã¨ã‚’éå‡¡ãªæƒ…ç†±ã‚’æŒã£ã¦è¡Œã†ã€‚",
    "æŒ‘æˆ¦ã™ã‚Œã°ã€æˆåŠŸã‹å­¦ã³ã®ã©ã¡ã‚‰ã‹ã—ã‹ãªã„ã€‚", "ä»Šæ—¥ã®æˆæœã¯éå»ã®åŠªåŠ›ã®çµæœã§ã‚ã‚Šã€æœªæ¥ã¯ã“ã‚Œã‹ã‚‰ã®åŠªåŠ›ã§æ±ºã¾ã‚‹ã€‚", "äººã¯ã€è‡ªåˆ†ãŒè€ƒãˆãŸé€šã‚Šã®äººé–“ã«ãªã‚‹ã€‚",
    "æƒ…ç†±ãªã—ã«å‰å¤§ãªã“ã¨ã¯æˆã—é‚ã’ã‚‰ã‚Œãªã„ã€‚", "çŸ³ã®ä¸Šã«ã‚‚ä¸‰å¹´ã€‚ç¶™ç¶šã¯åŠ›ãªã‚Šã€‚", "ã§ãã‚‹ã¨ä¿¡ã˜ã‚‹ã‹ã€ã§ããªã„ã¨ä¿¡ã˜ã‚‹ã‹ã€‚ã©ã¡ã‚‰ã‚‚æ­£ã—ã„ã€‚",
    "å•é¡Œãªã®ã¯ã€å•é¡ŒãŒã‚ã‚‹ã“ã¨ã§ã¯ãªã„ã€‚å•é¡Œæ„è­˜ãŒãªã„ã“ã¨ã ã€‚", "æº–å‚™ã‚’æ€ ã‚‹ã“ã¨ã¯ã€å¤±æ•—ã®æº–å‚™ã‚’ã™ã‚‹ã“ã¨ã ã€‚", "è¨€ã„è¨³ã¯ã€æ•—è€…ã®ãŸã‚ã®é®ç—›å‰¤ã«ã™ããªã„ã€‚",
    "è¡Œå‹•ã‚’ä¼´ã‚ãªã„ãƒ“ã‚¸ãƒ§ãƒ³ã¯ã€ãŸã ã®å¤¢ã ã€‚", "è‡ªåˆ†ã‚’ä¿¡ã˜ã‚ã€‚ãã‚ŒãŒæˆåŠŸã¸ã®ç¬¬ä¸€æ­©ã ã€‚", "ç›®æ¨™ã‚’é”æˆã™ã‚‹ç§˜è¨£ã¯ã€è¡Œå‹•ã‚’å§‹ã‚ã‚‹ã“ã¨ã ã€‚",
    "å°ã•ãªä¸€æ­©ã®ç©ã¿é‡ã­ãŒã€ã¨ã‚“ã§ã‚‚ãªã„æ‰€ã¸è¡ŒããŸã ä¸€ã¤ã®é“ã ã€‚", "å›°é›£ã®å‘ã“ã†ã«ã€æˆé•·ãŒã‚ã‚‹ã€‚", "ç†±æ„ã¯ã€ã‚¹ã‚­ãƒ«ã«å‹ã‚‹ã€‚",
    "ãŠå®¢æ§˜ã®æˆåŠŸãŒã€æˆ‘ã€…ã®æˆåŠŸã ã€‚", "èãåŠ›ã¯ã€æœ€å¼·ã®å–¶æ¥­ã‚¹ã‚­ãƒ«ã ã€‚", "ç´„æŸã¯ã€ä½•ãŒã‚ã£ã¦ã‚‚å®ˆã‚Œã€‚ãã‚ŒãŒä¿¡é ¼ã ã€‚", "ä»Šæ—¥ã®ã‚¿ãƒã¾ããŒã€æ˜æ—¥ã®åç©«ã«ãªã‚‹ã€‚",
    "ãƒ©ã‚¤ãƒãƒ«ã¯ã€å¸‚å ´ã«ã§ã¯ãªãã€è‡ªåˆ†ã®ä¸­ã«ã„ã‚‹ã€‚", "å¤‰åŒ–ã‚’æã‚Œã‚‹ãªã€‚å¤‰åŒ–ã“ããŒãƒãƒ£ãƒ³ã‚¹ã ã€‚", "ã‚¹ãƒ”ãƒ¼ãƒ‰ã¯ã€èª æ„ã®è¡¨ã‚Œã ã€‚",
    "ã§ããªã„ç†ç”±ã‚’100å€‹æ¢ã™ã‚ˆã‚Šã€ã§ãã‚‹æ–¹æ³•ã‚’1ã¤è¦‹ã¤ã‘ã‚ã€‚", "ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã¨ã¯ã€æœŸå¾…ã‚’è¶…ãˆç¶šã‘ã‚‹äººé–“ã®ã“ã¨ã ã€‚", "æ„Ÿè¬ã®è¨€è‘‰ã¯ã€æœ€å¼·ã®äººé–“é–¢ä¿‚æ§‹ç¯‰è¡“ã ã€‚",
    "è‡ªåˆ†ã®ä»•äº‹ã«ã€ç‰©èªã‚’èªã‚‰ã›ã‚ã€‚", "é€†å¢ƒã¯ã€è‡ªåˆ†ã®çœŸä¾¡ã‚’è©¦ã™è©¦é‡‘çŸ³ã ã€‚", "æ±ºæ–­ã®é€Ÿã•ãŒã€ãƒ“ã‚¸ãƒã‚¹ã®é€Ÿã•ã ã€‚", "å­¦ã³ç¶šã‘ã‚‹è€…ã ã‘ãŒã€å‹ã¡ç¶šã‘ã‚‹ã€‚",
    "èª å®Ÿã•ã¯ã€ã©ã‚“ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã«ã‚‚å‹ã‚‹ã€‚", "ã€Œãªãœã€ã‚’5å›ç¹°ã‚Šè¿”ã›ã€‚æœ¬è³ªãŒè¦‹ãˆã¦ãã‚‹ã€‚", "æƒ…ç†±ã¯ã€ä¸å¯èƒ½ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚",
    "æœ€é«˜ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€æœ€é«˜ã®ç¬‘é¡”ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã€‚", "è«¦ã‚ãŸã‚‰ã€ãã“ã§è©¦åˆçµ‚äº†ã ã‚ˆã€‚", "å¤±æ•—ã‹ã‚‰å­¦ã¹ã°ã€ãã‚Œã¯ã‚‚ã†å¤±æ•—ã§ã¯ãªã„ã€‚",
    "ä¸€äººã®åŠ›ã¯å°ã•ã„ã€‚ã ãŒã€ãƒãƒ¼ãƒ ã®åŠ›ã¯ç„¡é™å¤§ã ã€‚", "å¸¸ã«åŠæ­©å…ˆã‚’èª­ã‚ã€‚ãã‚ŒãŒå„ªä½æ€§ã‚’ç”Ÿã‚€ã€‚", "ãŠå®¢æ§˜ã®æƒ³åƒã‚’è¶…ãˆãŸæ™‚ã€æ„Ÿå‹•ãŒç”Ÿã¾ã‚Œã‚‹ã€‚",
    "è‡ªåˆ†ã®é™ç•Œã‚’æ±ºã‚ã‚‹ã®ã¯ã€è‡ªåˆ†ã ã‘ã ã€‚", "è¡Œå‹•ã®é‡ãŒã€è‡ªä¿¡ã®é‡ã‚’æ±ºã‚ã‚‹ã€‚", "è‹¦ã—ã„æ™‚ã“ãã€ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ãŒå•ã‚ã‚Œã‚‹ã€‚", "åŸºæœ¬ã‚’ç–ã‹ã«ã™ã‚‹è€…ã«ã€å¿œç”¨ã¯ãªã„ã€‚",
    "ç›®æ¨™ã‚’ç´™ã«æ›¸ã‘ã°ã€ãã‚Œã¯è¨ˆç”»ã«ãªã‚‹ã€‚", "æƒ…ç†±ã¯ä¼æŸ“ã™ã‚‹ã€‚ã¾ãšè‡ªåˆ†ãŒç«ä»˜ã‘å½¹ã«ãªã‚Œã€‚", "No.1ã‚’ç›®æŒ‡ã•ãªã„è€…ã«ã€No.2ã®è³‡æ ¼ã‚‚ãªã„ã€‚",
    "ã€Œã‚ã‚ŠãŒã¨ã†ã€ã‚’ã€ä¸€æ—¥ä½•å›è¨€ã£ã¦ã„ã‚‹ã‹ï¼Ÿ", "å•é¡Œã¯ã€é¿ã‘ã‚‹ã‚‚ã®ã§ã¯ãªãã€è§£æ±ºã™ã‚‹ã‚‚ã®ã ã€‚", "è‡ªåˆ†ã®ä»•äº‹ã«ã€æ„›ã¯ã‚ã‚‹ã‹ï¼Ÿ",
    "æˆåŠŸè€…ã¯ã€ä¾‹å¤–ãªãèãä¸Šæ‰‹ã ã€‚", "æº–å‚™ã«ã‹ã‘ãŸæ™‚é–“ãŒã€å•†è«‡ã®æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã€‚", "è¨€ã„è¨³ã®ã†ã¾ã„äººé–“ã«ã€ä»•äº‹ã®ã§ãã‚‹äººé–“ã¯ã„ãªã„ã€‚",
    "ãƒªã‚¹ã‚¯ã‚’å–ã‚‰ãªã„ã“ã¨ãŒã€æœ€å¤§ã®ãƒªã‚¹ã‚¯ã€‚", "è¿·ã£ãŸã‚‰ã€ãŠå®¢æ§˜ã«ã¨ã£ã¦ãƒ—ãƒ©ã‚¹ã«ãªã‚‹æ–¹ã‚’é¸ã¹ã€‚", "ã€Œã§ãã¾ã›ã‚“ã€ã§ã¯ãªãã€ã€Œã©ã†ã™ã‚Œã°ã§ãã‚‹ã‹ã€ã‚’è€ƒãˆã‚ã€‚",
    "ãƒ©ã‚¤ãƒãƒ«ã«å‹ã¤ã“ã¨ã‚ˆã‚Šã€ãŠå®¢æ§˜ã«å‹ãŸã›ã‚‹ã“ã¨ã‚’è€ƒãˆã‚ã€‚", "ã‚¯ãƒ¬ãƒ¼ãƒ ã¯ã€å®ã®å±±ã ã€‚", "æ„Ÿå‹•ã¯ã€ç´°éƒ¨ã«å®¿ã‚‹ã€‚",
    "è‡ªåˆ†ã®æˆé•·ãŒã€ä¼šç¤¾ã®æˆé•·ã«ç¹‹ãŒã‚‹ã€‚", "ç›®æ¨™ã‚’å…±æœ‰ã™ã‚Œã°ã€ãã‚Œã¯ãƒãƒ¼ãƒ ã®åŠ›ã«ãªã‚‹ã€‚", "å¸¸ã«æ˜ã‚‹ãã€å…ƒæ°—ã‚ˆãã€å‰å‘ãã«ã€‚",
    "å³ãƒ¬ã‚¹ã€å³å¯¾å¿œã€‚ä¿¡é ¼ã¯ãã“ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã€‚", "PDCAã®Cï¼ˆãƒã‚§ãƒƒã‚¯ï¼‰ãŒä¸€ç•ªå¤§äº‹ã ã€‚", "å›°é›£ãªé“ã“ãã€è‡ªåˆ†ã‚’æˆé•·ã•ã›ã‚‹è¿‘é“ã ã€‚",
    "ã€Œã‚‚ã—ã€ã‚’èªã‚‹ãªã€‚ã€Œã©ã†ã€ã‚’èªã‚Œã€‚", "è‡ªåˆ†ã®è¨€è‘‰ã«è²¬ä»»ã‚’æŒã¦ã€‚", "ãŠå®¢æ§˜ã®ãƒ“ã‚¸ãƒã‚¹ã‚’ã€è‡ªåˆ†äº‹ã¨ã—ã¦è€ƒãˆã‚ã€‚", "æŒ¨æ‹¶ã¯ã€äººé–“é–¢ä¿‚ã®åŸºæœ¬ã®ã‚­ã€‚",
    "ãƒ¡ãƒ¢ã‚’å–ã‚‹ç¿’æ…£ãŒã€è¨˜æ†¶ã®é™ç•Œã‚’è¶…ãˆã‚‹ã€‚", "æ™‚é–“ã ã‘ã¯ã€èª°ã«ã§ã‚‚å¹³ç­‰ã ã€‚ã©ã†ä½¿ã†ã‹ã§å·®ãŒã¤ãã€‚", "ã€ŒçŸ¥ã£ã¦ã„ã‚‹ã€ã¨ã€Œã§ãã‚‹ã€ã¯é•ã†ã€‚",
    "ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°ã¯ã€æœ¬ç•ªã®ãŸã‚ã®æœ€é«˜ã®ç·´ç¿’ã ã€‚", "ãƒˆãƒƒãƒ—ã‚»ãƒ¼ãƒ«ã‚¹ã®çœŸä¼¼ã‚’ã—ã‚ã€‚ã¾ãšã¯ãã“ã‹ã‚‰ã ã€‚", "ç¬‘é¡”ã¯ã€ã‚³ã‚¹ãƒˆã‚¼ãƒ­ã®æœ€å¼·ã®æ­¦å™¨ã ã€‚",
    "ã€Œãªãœãªã‚‰ã€ã§èªã‚‹ç™–ã‚’ã¤ã‘ã‚ã€‚èª¬å¾—åŠ›ãŒå¤‰ã‚ã‚‹ã€‚", "ç›®çš„æ„è­˜ãŒã€è¡Œå‹•ã®è³ªã‚’é«˜ã‚ã‚‹ã€‚", "è‡ªåˆ†ã®å¼·ã¿ã‚’çŸ¥ã‚Šã€ãã‚Œã‚’ç£¨ãç¶šã‘ã‚ã€‚",
    "å¼±éŸ³ã‚’åãå‰ã«ã€é™ç•Œã¾ã§ã‚„ã‚Œã€‚", "ã€Œé‹ã€ã¯ã€æº–å‚™ãŒæ•´ã£ãŸè€…ã«è¨ªã‚Œã‚‹ã€‚", "ãŠå®¢æ§˜ã®æˆåŠŸäº‹ä¾‹ã‚’èªã‚Œã€‚ãã‚ŒãŒæœ€é«˜ã®å–¶æ¥­ãƒ„ãƒ¼ãƒ«ã ã€‚",
    "æ–­ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ã€æ¥½ã—ã‚ã€‚", "å¸¸ã«å¹³å¸¸å¿ƒã€‚ãã‚ŒãŒãƒ—ãƒ­ã®è¨¼ã ã€‚", "ç›®æ¨™ã¯ã€æ•°å€¤åŒ–ã—ã¦ã“ãæ„å‘³ãŒã‚ã‚‹ã€‚", "ä»²é–“ã‚’åŠ©ã‘ã‚ã€‚ãã‚ŒãŒå›ã‚Šå›ã£ã¦è‡ªåˆ†ã‚’åŠ©ã‘ã‚‹ã€‚",
    "ã€Œã™ã¿ã¾ã›ã‚“ã€ã‚ˆã‚Šã€Œã‚ã‚ŠãŒã¨ã†ã€ã‚’ã€‚", "è‡ªåˆ†ã®ä»•äº‹ã®ä¾¡å€¤ã‚’ã€è‡ªåˆ†ã§ä¿¡ã˜ã‚ã€‚", "è¡Œå‹•ã™ã‚Œã°ã€æ¬¡ã®è¡Œå‹•ãŒè¦‹ãˆã¦ãã‚‹ã€‚", "æˆåŠŸã®åå¯¾ã¯ã€ä½•ã‚‚ã—ãªã„ã“ã¨ã ã€‚"
  ];


  // ===============================================================
  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  // ===============================================================
  window.onload = function() {
    initSkillTags();
    setupEventListeners();
    document.getElementById("defaultOpen").click();
    triggerSearch(1);
  };

  function setupEventListeners() {
    document.getElementById('search-form').addEventListener('input', debounce(function() { triggerSearch(1); }, 500));
    document.querySelectorAll('input[name="db_type"]').forEach(function(radio) {
      radio.addEventListener('change', function() {
        toggleFilters();
        triggerSearch(1);
      });
    });
    document.getElementById('close-preview-btn').addEventListener('click', function() {
      document.getElementById('preview-pane').classList.add('hidden');
      document.getElementById('left-pane').classList.remove('shrunk');
      document.getElementById('open-gmail-btn').classList.add('hidden');
    });
    document.getElementById('refresh-cache-btn').addEventListener('click', handleRefreshCache);
    document.getElementById('delete-data-btn').addEventListener('click', handleDeleteOldData);
    document.getElementById('matching-btn').addEventListener('click', handleMatching);
    document.getElementById('cancel-matching-btn').addEventListener('click', handleCancelMatching);
    document.querySelectorAll('input[name="match_type"]').forEach(function(radio) {
      radio.addEventListener('change', updateMatchingPlaceholder);
    });
    
    document.getElementById('reset-search-btn').addEventListener('click', function(event) {
        event.stopPropagation();
        handleResetSearch();
    });
    
    updateMatchingPlaceholder();

    document.getElementById('skill-tags-toggle').addEventListener('click', function() {
        const container = document.getElementById('skill-tags-container');
        const icon = document.getElementById('skill-tags-toggle-icon');
        container.classList.toggle('collapsed');
        if (container.classList.contains('collapsed')) {
            icon.textContent = 'â–¶';
        } else {
            icon.textContent = 'â–¼';
        }
    });

    document.getElementById('import-btn').addEventListener('click', handleImport);
    document.getElementById('url-search-btn').addEventListener('click', handleUrlSearch);
  }


  // ===============================================================
  // æ©Ÿèƒ½é–¢æ•°
  // ===============================================================

  function handleUrlSearch() {
    const urls = document.getElementById('search-urls').value;
    const keyword = document.getElementById('search-keyword').value;

    if (!urls.trim() || !keyword.trim()) {
      alert('æ¤œç´¢å¯¾è±¡ã®URLã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return;
    }

    const loader = document.getElementById('url-search-loader');
    const resultsDiv = document.getElementById('url-search-results');
    const searchBtn = document.getElementById('url-search-btn');
    const sessionId = Date.now().toString(); // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ID

    let allMatchingUrls = [];
    let allErrors = [];
    let processedCount = 0;
    let totalUrls = 0;

    loader.classList.remove('hidden');
    searchBtn.disabled = true;
    resultsDiv.innerHTML = '';
    resultsDiv.innerHTML = '<p>æ¤œç´¢ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...</p>';

    // æ¤œç´¢åˆæœŸåŒ–
    google.script.run
      .withSuccessHandler(function(response) {
        totalUrls = response.totalUrls;
        resultsDiv.innerHTML = `<p>å…¨ ${totalUrls} ä»¶ã®URLã‚’æ¤œç´¢ã—ã¾ã™ã€‚</p><div id="url-search-progress"></div><div id="url-search-matches"></div><div id="url-search-errors"></div>`;
        processNextBatch(sessionId, 0);
      })
      .withFailureHandler(function(error) {
        loader.classList.add('hidden');
        searchBtn.disabled = false;
        resultsDiv.innerHTML = `<p style="color: red;">ã‚¨ãƒ©ãƒ¼: ${escapeHtml(error.message)}</p>`;
      })
      .initializeUrlSearch(urls, keyword, sessionId);

    function processNextBatch(currentSessionId, startIndex) {
      google.script.run
        .withSuccessHandler(function(response) {
          if (response.success) {
            allMatchingUrls = allMatchingUrls.concat(response.matchingUrls);
            allErrors = allErrors.concat(response.errors);
            processedCount += response.processedCount;

            updateSearchResultsDisplay(processedCount, totalUrls, allMatchingUrls, allErrors);

            if (response.nextStartIndex !== null) {
              // æ¬¡ã®ãƒãƒƒãƒã‚’å‡¦ç†
              processNextBatch(currentSessionId, response.nextStartIndex);
            } else {
              // å…¨ã¦ã®ãƒãƒƒãƒå‡¦ç†ãŒå®Œäº†
              loader.classList.add('hidden');
              searchBtn.disabled = false;
              google.script.run.clearUrlSearchSession(currentSessionId);
              resultsDiv.innerHTML += '<p>æ¤œç´¢ãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>';
            }
          } else {
            // ãƒãƒƒãƒå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
            loader.classList.add('hidden');
            searchBtn.disabled = false;
            google.script.run.clearUrlSearchSession(currentSessionId);
            resultsDiv.innerHTML = `<p style="color: red;">ã‚¨ãƒ©ãƒ¼: ${escapeHtml(response.error)}</p>`;
          }
        })
        .withFailureHandler(function(error) {
          loader.classList.add('hidden');
          searchBtn.disabled = false;
          google.script.run.clearUrlSearchSession(currentSessionId);
          resultsDiv.innerHTML = `<p style="color: red;">ã‚¨ãƒ©ãƒ¼: ${escapeHtml(error.message)}</p>`;
        })
        .processUrlBatch(currentSessionId, startIndex);
    }

    function updateSearchResultsDisplay(currentProcessed, total, matches, errors) {
      const progressDiv = document.getElementById('url-search-progress');
      const matchesDiv = document.getElementById('url-search-matches');
      const errorsDiv = document.getElementById('url-search-errors');

      progressDiv.innerHTML = `<p>å‡¦ç†ä¸­: ${currentProcessed} / ${total} ä»¶</p>`;

      let matchesHtml = '<h4>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã£ãŸURL (' + matches.length + 'ä»¶)</h4>';
      if (matches.length > 0) {
        matchesHtml += '<ul>';
        matches.forEach(function(url) {
          matchesHtml += `<li><a href="${escapeHtml(url)}" target="_blank">${escapeHtml(url)}</a></li>`;
        });
        matchesHtml += '</ul>';
      } else {
        matchesHtml += '<p>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ä¸€è‡´ã™ã‚‹URLã¯ã¾ã è¦‹ã¤ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚</p>';
      }
      matchesDiv.innerHTML = matchesHtml;

      let errorsHtml = '<h4 style="color: red;">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸURL (' + errors.length + 'ä»¶)</h4>';
      if (errors.length > 0) {
        errorsHtml += '<ul>';
        errors.forEach(function(error) {
          errorsHtml += `<li>${escapeHtml(error.url)} - <strong>${escapeHtml(error.message)}</strong></li>`;
        });
        errorsHtml += '</ul>';
      } else {
        errorsHtml += '<p>ã‚¨ãƒ©ãƒ¼ã¯ç™ºç”Ÿã—ã¦ã„ã¾ã›ã‚“ã€‚</p>';
      }
      errorsDiv.innerHTML = errorsHtml;
    }
  }
  
  function openTab(evt, tabName) {
    let i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tab-content");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("header-tab-link");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "flex";
    evt.currentTarget.className += " active";
  }

  function initSkillTags() {
    const container = document.getElementById('skill-tags-container');
    container.innerHTML = ''; 

    for (const category in SKILL_CATEGORIES) {
        const details = document.createElement('details');
        details.className = 'skill-category';

        const summary = document.createElement('summary');
        summary.textContent = category;
        details.appendChild(summary);

        const grid = document.createElement('div');
        grid.className = 'skill-tags-grid';

        SKILL_CATEGORIES[category].forEach(function(skill) {
            const id = 'skill_' + skill.replace(/[^a-zA-Z0-9]/g, '');
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'skill-tag-item';

            const input = document.createElement('input');
            input.type = 'checkbox';
            input.id = id;
            input.name = 'skill_tags';
            input.value = skill;

            const label = document.createElement('label');
            label.htmlFor = id;
            label.textContent = skill;

            itemDiv.appendChild(input);
            itemDiv.appendChild(label);
            grid.appendChild(itemDiv);
        });

        details.appendChild(grid);
        container.appendChild(details);
    }
  }
  
  function triggerSearch(page) {
    page = page || 1;
    currentPage = page;
    searchRetryCount = 0;
    
    if (typeof google === 'undefined' || typeof google.script === 'undefined' || typeof google.script.run === 'undefined') {
        setTimeout(function() { triggerSearch(page); }, 200);
        return;
    }
    showLoader(true);
    document.getElementById('results-table-container').innerHTML = '';
    document.getElementById('results-count').textContent = '';
    document.getElementById('pagination-controls').innerHTML = '';
    
    const params = getSearchParams();
    google.script.run
      .withSuccessHandler(displayResults)
      .withFailureHandler(handleError)
      .searchDatabase(params, currentPage, ITEMS_PER_PAGE);
  }

  function getSearchParams() {
    const dbType = document.querySelector('input[name="db_type"]:checked').value;
    const params = {
      db_type: dbType,
      free_word: document.getElementById('free_word').value,
      skill_tags: Array.from(document.querySelectorAll('input[name="skill_tags"]:checked')).map(function(el) { return el.value; }),
    };
    if (dbType === 'jinzai') {
        params.age_min = document.getElementById('age_min').value;
        params.age_max = document.getElementById('age_max').value;
        params.price_min = document.getElementById('price_min_jinzai').value;
        params.price_max = document.getElementById('price_max_jinzai').value;
        params.work_style = document.getElementById('work_style_jinzai').value;
        params.affiliation_type = document.querySelector('input[name="affiliation_type"]:checked').value;
        params.nationality_type = document.querySelector('input[name="nationality_type"]:checked').value;
    } else {
        params.free_word = document.getElementById('free_word_anken').value;
        params.price_min = document.getElementById('price_min_anken').value;
        params.price_max = document.getElementById('price_max_anken').value;
        params.work_style = document.getElementById('work_style_anken').value;
    }
    return params;
  }
  
  function toggleFilters() {
    const dbType = document.querySelector('input[name="db_type"]:checked').value;
    document.getElementById('jinzai-filters').classList.toggle('hidden', dbType !== 'jinzai');
    document.getElementById('anken-filters').classList.toggle('hidden', dbType === 'jinzai');
  }

  function displayResults(response) {
    try {
      if (response === null && searchRetryCount < 1) {
        searchRetryCount++;
        console.log("Response was null. Retrying search... (Attempt " + searchRetryCount + ")");
        setTimeout(function() {
            const params = getSearchParams();
            google.script.run
                .withSuccessHandler(displayResults)
                .withFailureHandler(handleError)
                .searchDatabase(params, currentPage, ITEMS_PER_PAGE);
        }, 2000);
        return;
      }
      
      showLoader(false);
      
      if (response === null || response === undefined) {
        handleError("ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å¿œç­”ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ (null)ã€‚å‡¦ç†ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸã‹ã€ã‚µãƒ¼ãƒãƒ¼å´ã§äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚");
        return;
      }

      if (response.error) {
        handleError("Backend error: " + response.error);
        return;
      }

      if (!Array.isArray(response.headers) || !Array.isArray(response.data)) {
        handleError("ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ä¸æ­£ãªå½¢å¼ã®å¿œç­”ãŒã‚ã‚Šã¾ã—ãŸã€‚");
        return;
      }
      
      const { headers, data, totalItems } = response;
      const dbType = document.querySelector('input[name="db_type"]:checked').value;
      const displayHeaders = dbType === 'jinzai' ? JINZAI_HEADERS : ANKEN_HEADERS;
      
      const colIndices = displayHeaders.map(function(h) {
        if (h === 'å˜ä¾¡') {
            const priceIndex = headers.indexOf('å¸Œæœ›å˜ä¾¡');
            return priceIndex !== -1 ? priceIndex : headers.indexOf('å˜ä¾¡');
        }
        return headers.indexOf(h);
      });

      const mailIdIndex = headers.indexOf('ãƒ¡ãƒ¼ãƒ«ID');
      const mailLinkIndex = headers.indexOf('ãƒ¡ãƒ¼ãƒ«ãƒªãƒ³ã‚¯');
      const idIndex = headers.indexOf('ID');
      const companyIndex = headers.indexOf('ç¤¾å');
      const nameIndex = headers.indexOf(dbType === 'jinzai' ? 'æ°å' : 'æ¡ˆä»¶å');

      const container = document.getElementById('results-table-container');
      container.innerHTML = '';

      const table = document.createElement('table');
      table.className = 'data-table';
      
      const thead = table.createTHead();
      const headerRow = thead.insertRow();
      displayHeaders.forEach(function(headerText) {
        const th = document.createElement('th');
        th.className = 'col-' + sanitizeHeaderForClass(headerText);
        th.textContent = headerText;
        headerRow.appendChild(th);
      });

      const tbody = table.createTBody();
      if(data.length > 0) {
        data.forEach(function(row) {
          const tr = tbody.insertRow();
          tr.onclick = function() { showPreview(this); };
          
          const id = row[idIndex] || '';
          const company = row[companyIndex] || '';
          const name = row[nameIndex] || '';
          const mailId = row[mailIdIndex] || '';
          const mailLink = row[mailLinkIndex] || '';
          
          tr.dataset.mailId = mailId;
          tr.dataset.mailLink = mailLink;
          tr.dataset.id = id;
          tr.dataset.company = company;
          tr.dataset.name = name;

          colIndices.forEach(function(index, i) {
            const td = tr.insertCell();
            const header = displayHeaders[i];
            td.className = 'col-' + sanitizeHeaderForClass(header);
            
            let cellData = (index === -1) ? '' : (row[index] || '');

            if (header === 'å—ä¿¡æ—¥æ™‚') {
              td.innerHTML = formatDateTime(cellData);
            } else if (header === 'æœ€å¯„é§…' && cellData) {
              const a = document.createElement('a');
              a.href = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(cellData);
              a.target = '_blank';
              a.textContent = cellData;
              td.appendChild(a);
            } else {
              td.textContent = cellData;
            }
          });
        });
      } else {
          const tr = tbody.insertRow();
          const td = tr.insertCell();
          td.colSpan = displayHeaders.length;
          td.textContent = 'ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚';
      }

      container.appendChild(table);
      
      const startItem = (currentPage - 1) * ITEMS_PER_PAGE + 1;
      const endItem = Math.min(startItem + ITEMS_PER_PAGE - 1, totalItems);
      document.getElementById('results-count').textContent = `(${totalItems > 0 ? startItem + ' - ' + endItem + ' / ' : ''}${totalItems}ä»¶)`;
      renderPagination(totalItems);

    } catch (e) {
      handleError(e);
    }
  }
  
  function showPreview(element) {
    const mailId = element.dataset.mailId;
    const mailLink = element.dataset.mailLink;
    const id = element.dataset.id;
    const company = element.dataset.company;
    const name = element.dataset.name;

    const previewPane = document.getElementById('preview-pane');
    const iframe = document.getElementById('mail-preview');
    const infoDiv = document.getElementById('preview-info');
    const gmailBtn = document.getElementById('open-gmail-btn');

    infoDiv.innerHTML = '<div><span><strong>ID:</strong> ' + escapeHtml(id) + '</span> ' +
                         '<span><strong>ç¤¾å:</strong> ' + escapeHtml(company) + '</span> ' +
                         '<span><strong>æ°å/æ¡ˆä»¶å:</strong> ' + escapeHtml(name) + '</span></div>' +
                         '<div style="margin-top: 5px;"><strong>ä»¶å:</strong> <span id="preview-subject" style="cursor: pointer;" title="ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚³ãƒ”ãƒ¼">èª­ã¿è¾¼ã¿ä¸­...</span></div>';

    if (mailLink && mailLink.startsWith('http')) {
        gmailBtn.onclick = function() { window.open(mailLink, '_blank'); };
        gmailBtn.classList.remove('hidden');
    } else {
        gmailBtn.classList.add('hidden');
    }
    
    document.getElementById('left-pane').classList.add('shrunk');
    previewPane.classList.remove('hidden');
    iframe.srcdoc = "èª­ã¿è¾¼ã¿ä¸­...";
    
    if (mailId && !mailId.startsWith('http')) {
        google.script.run
          .withSuccessHandler(function(response) {
            const subjectSpan = document.getElementById('preview-subject');
            subjectSpan.textContent = response.subject;
            subjectSpan.onclick = function() { copyToClipboard(response.subject, subjectSpan); };

            const styledBody = '<style>' +
                'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 14px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }' +
                '</style>' + response.body;
            iframe.srcdoc = styledBody;
          })
          .withFailureHandler(function(error) {
              handleError(error);
              document.getElementById('preview-subject').textContent = 'å–å¾—ã‚¨ãƒ©ãƒ¼';
          })
          .getMailBody(mailId);
    } else {
        document.getElementById('preview-subject').textContent = 'N/A';
        iframe.srcdoc = "ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯URLã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸãŸã‚ã€ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
    }
  }

  function copyToClipboard(text, element) {
    navigator.clipboard.writeText(text).then(function() {
      const originalText = element.textContent;
      element.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
      setTimeout(function() {
        element.textContent = originalText;
      }, 1500);
    }, function(err) {
      console.error('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ', err);
      alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    });
  }
  
  function handleDeleteOldData() {
    if(confirm('ç™»éŒ²ã‹ã‚‰14æ—¥ä»¥ä¸ŠçµŒéã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
        showLoader(true);
        google.script.run
            .withSuccessHandler(function(response) {
                showLoader(false);
                alert(response.message);
                triggerSearch(1);
            })
            .withFailureHandler(handleError)
            .deleteOldData();
    }
  }

  function handleRefreshCache() {
    showLoader(true);
    google.script.run
        .withSuccessHandler(function(message) {
            alert(message);
            triggerSearch(1);
        })
        .withFailureHandler(handleError)
        .clearCache();
  }
  
  function handleMatching() {
    const matchType = document.querySelector('input[name="match_type"]:checked').value;
    const inputText = document.getElementById('matching-text').value;
    const sourceId = document.getElementById('matching-id').value;
    const maxResults = document.getElementById('max-matching-results').value;
    const additionalPrompt = document.getElementById('matching-prompt').value;
    if (!inputText.trim() && !sourceId.trim()) {
        alert('ãƒãƒƒãƒãƒ³ã‚°å…ƒã®æƒ…å ±ï¼ˆIDã¾ãŸã¯ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
    }
    
    isMatchingCancelled = false;
    document.getElementById('matching-btn').classList.add('hidden');
    document.getElementById('cancel-matching-btn').classList.remove('hidden');

    showLoader(true);
    const resultsDiv = document.getElementById('matching-results');
    resultsDiv.innerHTML = 'AIãŒãƒãƒƒãƒãƒ³ã‚°å€™è£œã‚’æ¤œç´¢ä¸­ã§ã™...';
    
    google.script.run
        .withSuccessHandler(function(response) {
            if (isMatchingCancelled) return;
            showLoader(false);
            document.getElementById('matching-btn').classList.remove('hidden');
            document.getElementById('cancel-matching-btn').classList.add('hidden');

            if (response.success) {
                displayMatchingResults(response.result);
            } else {
                resultsDiv.innerHTML = '<p style="color: red;">' + response.error + '</p>';
            }
        })
        .withFailureHandler(handleError)
        .performMatching(matchType, inputText, maxResults, additionalPrompt, sourceId);
  }
  
  function handleCancelMatching() {
    isMatchingCancelled = true;
    showLoader(false);
    document.getElementById('matching-btn').classList.remove('hidden');
    document.getElementById('cancel-matching-btn').classList.add('hidden');
    document.getElementById('matching-results').innerHTML = '<p>ãƒãƒƒãƒãƒ³ã‚°ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚</p>';
  }

  function displayMatchingResults(results) {
    const resultsDiv = document.getElementById('matching-results');
    if (!results || results.length === 0) {
        resultsDiv.innerHTML = '<p>ãƒãƒƒãƒã™ã‚‹å€™è£œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
        return;
    }
    
    const matchType = document.querySelector('input[name="match_type"]:checked').value;
    
    const ul = document.createElement('ul');
    const h3 = document.createElement('h3');
    h3.textContent = 'ãƒãƒƒãƒãƒ³ã‚°çµæœ';
    
    results.forEach(function(item) {
        const fullData = item.fullData;
        if (!fullData) return;

        const id = fullData.ID || '';
        const company = fullData.ç¤¾å || '';
        const name = (matchType === 'jinzai') ? (fullData.æ¡ˆä»¶å || '') : (fullData.æ°å || '');
        const mailId = fullData.ãƒ¡ãƒ¼ãƒ«ID || '';
        const mailLink = fullData.ãƒ¡ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ || '';
        const reason = item.reason || 'ç†ç”±ä¸æ˜';

        const li = document.createElement('li');
        li.style.cursor = 'pointer';
        
        li.dataset.mailId = mailId;
        li.dataset.mailLink = mailLink;
        li.dataset.id = id;
        li.dataset.company = company;
        li.dataset.name = name;
        li.onclick = function() { showPreview(this); };
        
        const strong = document.createElement('strong');
        strong.textContent = 'å€™è£œID: ' + id;
        
        li.appendChild(strong);
        li.appendChild(document.createElement('br'));
        li.appendChild(document.createTextNode('ç†ç”±: ' + reason));
        
        ul.appendChild(li);
    });
    
    resultsDiv.innerHTML = '';
    resultsDiv.appendChild(h3);
    resultsDiv.appendChild(ul);
  }

  function handleImport() {
    const urls = document.getElementById('import-urls').value;
    if (!urls.trim()) {
      alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return;
    }

    const loader = document.getElementById('import-loader');
    const resultsDiv = document.getElementById('import-results');
    const importBtn = document.getElementById('import-btn');

    loader.classList.remove('hidden');
    importBtn.disabled = true;
    resultsDiv.innerHTML = '';

    google.script.run
      .withSuccessHandler(function(response) {
        loader.classList.add('hidden');
        importBtn.disabled = false;
        resultsDiv.textContent = response.message;
        if (response.success) {
          if (response.totalImported > 0) {
            handleRefreshCache();
          }
        }
      })
      .withFailureHandler(function(error) {
        loader.classList.add('hidden');
        importBtn.disabled = false;
        resultsDiv.textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
      })
      .importFromUrls(urls);
  }


  // ===============================================================
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
  // ===============================================================
  
  function handleResetSearch() {
    document.getElementById('search-form').reset();
    toggleFilters();
    triggerSearch(1);
  }

  function renderPagination(totalItems) {
    const paginationContainer = document.getElementById('pagination-controls');
    paginationContainer.innerHTML = '';
    const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);

    if (totalPages <= 1) return;

    const prevButton = document.createElement('button');
    prevButton.textContent = 'å‰ã¸';
    prevButton.disabled = currentPage === 1;
    prevButton.onclick = function() { triggerSearch(currentPage - 1); };
    paginationContainer.appendChild(prevButton);

    const pageInfo = document.createElement('span');
    pageInfo.textContent = ' ' + currentPage + ' / ' + totalPages + ' ';
    paginationContainer.appendChild(pageInfo);

    const nextButton = document.createElement('button');
    nextButton.textContent = 'æ¬¡ã¸';
    nextButton.disabled = currentPage === totalPages;
    nextButton.onclick = function() { triggerSearch(currentPage + 1); };
    paginationContainer.appendChild(nextButton);
  }

  function updateMatchingPlaceholder() {
    const matchType = document.querySelector('input[name="match_type"]:checked').value;
    const promptInput = document.getElementById('matching-prompt');
    const idInput = document.getElementById('matching-id');
    const idLabel = document.getElementById('matching-id-label');

    if (matchType === 'jinzai') {
      promptInput.placeholder = 'å˜ä¾¡ãŒ70ä¸‡å††ä»¥ä¸Šã€ã‚‚ã—ãã¯ã‚¹ã‚­ãƒ«è¦‹åˆã„ã®æ¡ˆä»¶ã®ã¿æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚ã¾ãŸåŒä¸€ã ã¨æ€ã‚ã‚Œã‚‹æ¡ˆä»¶ã¯æœ€ã‚‚å˜ä¾¡ãŒé«˜ã„æ¡ˆä»¶ã®ã¿è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚';
      idLabel.textContent = 'IDã§äººæã‚’æŒ‡å®š:';
      idInput.placeholder = 'äººæDBã®IDã‚’å…¥åŠ›';
    } else { // 'anken'
      promptInput.placeholder = 'å¸Œæœ›å˜ä¾¡ãŒ60ä¸‡å††ä»¥ä¸‹ã®è¦å“¡ã®ã¿æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚ã¾ãŸåŒä¸€äººç‰©ã ã¨æ€ã‚ã‚Œã‚‹è¦å“¡ã¯å˜ä¾¡ãŒæœ€ã‚‚å®‰ã„æ–¹ã®ã¿è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚';
      idLabel.textContent = 'IDã§æ¡ˆä»¶ã‚’æŒ‡å®š:';
      idInput.placeholder = 'æ¡ˆä»¶DBã®IDã‚’å…¥åŠ›';
    }
  }

  function escapeHtml(text) {
    if (text === null || text === undefined) return '';
    const div = document.createElement('div');
    div.innerText = text;
    return div.innerHTML;
  }

  function formatDateTime(dateString) {
    if (!dateString) return '';
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
            return dateString;
        }
        const yyyy = date.getFullYear();
        const mm = String(date.getMonth() + 1).padStart(2, '0');
        const dd = String(date.getDate()).padStart(2, '0');
        const h = String(date.getHours()).padStart(2, '0');
        const m = String(date.getMinutes()).padStart(2, '0');
        return yyyy + '/' + mm + '/' + dd + '\n' + h + ':' + m;
    } catch (e) {
        return dateString;
    }
  }

  function sanitizeHeaderForClass(header) {
    const map = {
      'ID': 'id', 'å—ä¿¡æ—¥æ™‚': 'received-date', 'ç¤¾å': 'company', 'æ°å': 'name',
      'æ€§åˆ¥': 'gender', 'å›½ç±': 'nationality', 'å¹´é½¢': 'age', 'æœ€å¯„é§…': 'station',
      'æ‰€å±': 'affiliation', 'ã‚¹ã‚­ãƒ«ã‚¿ã‚°': 'skill-tags', 'ã‚¹ã‚­ãƒ«ã‚µãƒãƒªãƒ¼': 'skill-summary',
      'å¸Œæœ›ã‚µãƒãƒªãƒ¼': 'wish-summary', 'å¸Œæœ›ãƒã‚¸ã‚·ãƒ§ãƒ³': 'desired-position', 'ãã®ä»–ã‚µãƒãƒªãƒ¼': 'other-summary',
      'å˜ä¾¡': 'price',
      'æ¡ˆä»¶å': 'project-name', 'å ´æ‰€': 'location', 'ã‚¹ã‚­ãƒ«è¦ä»¶ã‚µãƒãƒªãƒ¼': 'skill-req-summary',
      'æ±‚ã‚ã‚‹ãƒã‚¸ã‚·ãƒ§ãƒ³': 'required-position', 'æœŸé–“': 'period'
    };
    return map[header] || 'generic-col';
  }
  
  function showLoader(show) {
    const loader = document.getElementById('loader');
    const quoteEl = document.getElementById('motivational-quote');

    if (show) {
        const randomIndex = Math.floor(Math.random() * SALES_QUOTES.length);
        quoteEl.textContent = SALES_QUOTES[randomIndex];
        loader.classList.remove('hidden');
    } else {
        loader.classList.add('hidden');
    }
  }
  
  function handleError(error) {
    showLoader(false);
    const errorString = (typeof error === 'object' && error.message) ? error.message : error.toString();
    document.getElementById('results-table-container').innerHTML = 
        '<p style="color: red; font-weight: bold;">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + escapeHtml(errorString) + '</p>' +
        '<p>è©³ç´°ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>';
  }
  
  function debounce(func, delay) {
    let timeout;
    return function() {
      const context = this;
      const args = arguments;
      clearTimeout(timeout);
      timeout = setTimeout(function() {
        func.apply(context, args);
      }, delay);
    };
  }
</script>
</body>
</html>
